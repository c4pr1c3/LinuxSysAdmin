<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="author" content="é»„ç®">
  <title>Linuxç³»ç»Ÿä¸ç½‘ç»œç®¡ç†</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="reveal.js/css/reveal.css">
  <style type="text/css">code{white-space: pre;}</style>


    <!-- For syntax highlighting using highlight.js-->
    <link rel="stylesheet" href="reveal.js/lib/css/zenburn.css">

  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="reveal.js/css/theme/white.css" id="theme">
  <!-- Printing and PDF exports -->
<link rel="stylesheet" media="print" href="reveal.js/css/print/pdf.css" />
  <script>
    var link = document.createElement( 'link' );
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = window.location.search.match( /print-pdf/gi ) ? 'reveal.js/css/print/pdf.css' : 'reveal.js/css/print/paper.css';
    document.getElementsByTagName( 'head' )[0].appendChild( link );
  </script>
  <!--[if lt IE 9]>
  <script src="reveal.js/lib/js/html5shiv.js"></script>
  <![endif]-->
</head>
<body>
  <div class="reveal">
    <div class="slides">

<section id="title-slide">
  <h1 class="title">Linuxç³»ç»Ÿä¸ç½‘ç»œç®¡ç†</h1>
  <p class="author">é»„ç®</p>
</section>

<section>
<section id="ç•ªå¤–cloud-init" class="title-slide slide level1">
<h1>ç•ªå¤–ï¼šCloud-Init</h1>

</section>
<section class="slide level2">

<ul>
<li><code>ansible</code> çš„ä½¿ç”¨å¯¹ç›®æ ‡è¿è¡Œç¯å¢ƒä¹Ÿæœ‰ä¾èµ–è¦æ±‚
<ul>
<li>Python è§£é‡Šå™¨</li>
<li>SSH å…å¯†ç™»å½•</li>
</ul></li>
<li>ä»¥ <code>puppet</code> ä¸ºä»£è¡¨çš„åŸºäº <code>agent</code>
çš„è‡ªåŠ¨åŒ–ç®¡ç†ç³»ç»Ÿæ–¹æ¡ˆéœ€è¦åœ¨ã€ŒåŸºç¡€é•œåƒã€ä¸­æå‰å®‰è£…å¥½å¯¹åº”çš„
<code>agent</code> å¹¶è¿›è¡Œè¿è¡Œæ—¶ç¯å¢ƒç›¸å…³çš„å¿…è¦é…ç½®</li>
</ul>
</section>
<section class="slide level2">

<blockquote>
<p>ä»¥ä¸Šéœ€æ±‚å¯ä»¥é€šè¿‡åœ¨å®šåˆ¶ã€ŒåŸºç¡€é•œåƒã€é˜¶æ®µå°†ä¸Šè¿°ä¾èµ–è½¯ä»¶é¢„è£…åœ¨ç³»ç»Ÿä¸­</p>
</blockquote>
</section>
<section class="slide level2">

<blockquote>
<p>ä½†æ˜¯ï¼Œä¸Šè¿°åšæ³•å¹¶ä¸ã€Œä¼˜é›…ã€ã€‚</p>
</blockquote>
</section>
<section class="slide level2">

<p>ã€ŒåŸºç¡€é•œåƒã€åº”è¯¥æ»¡è¶³ä»¥ä¸‹ç‰¹æ€§ï¼š</p>
<ul>
<li>æœ€å¤§åŒ–ã€Œå¯å¤ç”¨ã€åœºæ™¯ï¼šæœ€å°åŒ–å®‰è£…ç³»ç»Ÿï¼Œåªè£…ã€Œæœ€æ™®ééœ€è¦ã€çš„åŸºç¡€è½¯ä»¶</li>
</ul>
</section>
<section class="slide level2">

<p>è€ƒè™‘ä»¥ä¸‹é›†ç¾¤æœåŠ¡å™¨ç®¡ç†çš„å¸¸è§éœ€æ±‚ï¼š</p>
<ul>
<li>æ–°å®‰è£…çš„ç³»ç»Ÿéœ€è¦é¢„å…ˆé…ç½®ä¸åŒç”¨æˆ·çš„ä¸åŒ SSH å…å¯†ç™»å½•å—ä¿¡ä»»å…¬é’¥</li>
<li>éƒ¨åˆ†æ–°ç³»ç»Ÿéœ€è¦å®‰è£…è½¯ä»¶Aï¼Œå¦ä¸€éƒ¨åˆ†æ–°ç³»ç»Ÿéœ€è¦å®‰è£…è½¯ä»¶B</li>
</ul>
</section>
<section class="slide level2">

<p>ä»¥ä¸Šéœ€æ±‚å¯¹åº”çš„æ“ä½œè¿‡ç¨‹å‡è¦æ±‚ <strong>è‡ªåŠ¨åŒ–</strong> ã€‚</p>
</section>
<section class="slide level2">

<p>è¿™å°±æ˜¯ <code>ä»ä¸€åˆ°äºŒã€åˆ°ä¸‰ï¼Œä¹ƒè‡³ä¸‡ç‰©</code> çš„
<strong>è‡ªåŠ¨åŒ–</strong> é—®é¢˜ã€‚</p>
</section>
<section class="slide level2">

<blockquote>
<p>æ€ä¹ˆè§£å†³ <code>ä»ä¸€åˆ°äºŒã€åˆ°ä¸‰ï¼Œä¹ƒè‡³ä¸‡ç‰©</code> çš„
<strong>è‡ªåŠ¨åŒ–</strong> é—®é¢˜ï¼Ÿ</p>
</blockquote>
</section>
<section id="cloud-init-usage" class="slide level2">
<h2>Cloud-Init çš„ä½œç”¨</h2>
<blockquote>
<p>è§£å†³ <code>ä»ä¸€åˆ°äºŒã€åˆ°ä¸‰ï¼Œä¹ƒè‡³ä¸‡ç‰©</code>
ï¼ˆä»åŸºæœ¬ç³»ç»Ÿåˆ°å¯ç¼–ç¨‹ã€å¯é…ç½®ï¼‰ çš„ <strong>è‡ªåŠ¨åŒ–</strong> é—®é¢˜</p>
</blockquote>
</section></section>
<section>
<section id="hello-cloud-init" class="title-slide slide level1">
<h1>ä»ã€Œç¬¬ä¸€ä¸ª ğŸŒ° ã€å¼€å§‹ä½“éªŒ cloud-init</h1>

</section>
<section class="slide level2">

<pre class="bash"><code># åœ¨åˆ¶ä½œæ— äººå€¼å®ˆå®‰è£…é•œåƒæˆ– PXE é•œåƒæ—¶å°† cloud-init å’Œ openssh-server é¢„è£…
sudo apt update &amp;&amp; sudo apt install cloud-init genisoimage

mkdir -p ~/workspace/cloud-init &amp;&amp; cd ~/workspace/cloud-init 

cat &lt;&lt; EOF &gt; ~/workspace/cloud-init/meta-data
instance-id: 1
local-hostname: cuc-cloud-init
EOF

cat &lt;&lt; EOF &gt; ~/workspace/cloud-init/user-data
#cloud-config
password: mypassword 
chpasswd: { expire: False }
ssh_pwauth: True
EOF

genisoimage -output init-cidata.iso -volid cidata -joliet -rock user-data meta-data</code></pre>
</section>
<section class="slide level2">

<ul>
<li>å°†è™šæ‹Ÿæœºå†…çš„ <code>init-cidata.iso</code> ä¸‹è½½åˆ°å®¿ä¸»æœºç³»ç»Ÿ</li>
<li>åœ¨ Virtualbox çš„å½“å‰è™šæ‹Ÿæœºè®¾ç½®ç•Œé¢æŒ‚è½½
<code>init-cidata.iso</code></li>
</ul>
<p><img data-src="images/cloud-init/vb-cidata.png" /></p>
</section>
<section class="slide level2">

<p>é‡å¯ <code>å½“å‰è™šæ‹Ÿæœº</code> ï¼Œç™»å½•è¿›å…¥ç³»ç»Ÿåï¼š</p>
<pre class="bash"><code># ç³»ç»Ÿçš„ä¸»æœºåå˜æˆäº†ä¸Šè¿°é…ç½®æ–‡ä»¶ç¤ºä¾‹é‡Œçš„ cuc-cloud-init

# æŸ¥çœ‹ç³»ç»Ÿä¸­ä¼šæ–°å¤šå‡ºä¸€ä¸ªç”¨æˆ· `ubuntu` 
id ubuntu

# è¾“å…¥ä¸Šè¿°é…ç½®æ–‡ä»¶ç¤ºä¾‹é‡Œè®¾ç½®çš„å£ä»¤ `mypassword` 
su ubuntu

# æ£€æŸ¥å½“å‰ç”¨æˆ·èº«ä»½
id</code></pre>
</section></section>
<section>
<section id="è¯¦è§£ä¸Šä¸€ä¸ª" class="title-slide slide level1">
<h1>è¯¦è§£ä¸Šä¸€ä¸ªğŸŒ°</h1>

</section>
<section id="user-data" class="slide level2">
<h2>user-data</h2>
<pre class="yaml"><code>#cloud-config</code></pre>
<ul>
<li>æ ‡è¯†å½“å‰æ–‡ä»¶æ˜¯ä¸€ä¸ª <code>cloud-config</code>
ç±»å‹æ–‡ä»¶ï¼Œè¿™æ˜¯æœ€å¸¸ç”¨çš„ä¸€ç±» <code>User-Data</code></li>
</ul>
</section>
<section class="slide level2">

<pre class="yaml"><code>password: mypassword </code></pre>
<p><code>Ubuntu</code> å‘è¡Œç‰ˆé»˜è®¤åˆ›å»ºçš„ç”¨æˆ·åä¸º
<code>ubuntu</code>ï¼Œæ­¤å¤„ <code>password</code> æŒ‡ä»¤ç­‰ä»·äºå…ˆåˆ›å»ºæ–°ç”¨æˆ·
<code>ubuntu</code> ï¼Œç„¶åè®¾ç½®å£ä»¤ä¸º <code>mypassword</code> ã€‚</p>
<ul>
<li><a
href="https://cloudinit.readthedocs.io/en/latest/topics/modules.html#users-and-groups">users
é…ç½®å…³é”®å­—å®šä¹‰çš„åˆ—è¡¨ä¸­ç¬¬ä¸€ä¸ªç”¨æˆ·å°±æ˜¯ç³»ç»Ÿçš„é»˜è®¤ç”¨æˆ·ï¼Œå¦‚æœå¸Œæœ›ä¿ç•™å‘è¡Œç‰ˆé»˜è®¤æ ‡å‡†ç”¨æˆ·ååˆ™ç¬¬ä¸€ä¸ªç”¨æˆ·åº”è®¾ç½®ä¸º
default</a> ã€‚</li>
<li>å£ä»¤æ ¼å¼æ—¢å¯ä»¥æ˜¯æ˜æ–‡ï¼Œä¹Ÿå¯ä»¥æ˜¯ <code>mkpasswd</code>
åˆ›å»ºçš„ã€Œå“ˆå¸Œåå£ä»¤ã€ã€‚</li>
</ul>
</section>
<section id="åˆ›å»ºå“ˆå¸Œåå£ä»¤çš„" class="slide level2">
<h2>åˆ›å»ºã€Œå“ˆå¸Œåå£ä»¤ã€çš„ğŸŒ°</h2>
<pre class="bash"><code>sudo apt install whois
mkpasswd -m help # è·å–å½“å‰ç‰ˆæœ¬æ”¯æŒçš„å“ˆå¸Œç®—æ³•
mkpasswd -m sha-512 mypassword</code></pre>
</section>
<section class="slide level2">

<pre class="yaml"><code>chpasswd: { expire: False }</code></pre>
<p><code>chpasswd</code> ç”¨äºå¯¹ç³»ç»Ÿä¸­ <strong>å·²æœ‰</strong>
ç”¨æˆ·æ›´æ”¹å£ä»¤æˆ–è®¾ç½®å£ä»¤å¼ºåˆ¶è¿‡æœŸç­–ç•¥ã€‚æ”¯æŒ <code>expire</code> å’Œ
<code>list</code> å±æ€§ã€‚å…¶ä¸­ <code>list</code> å…³é”®å­—æ”¯æŒ
<code>username:password</code> åˆ—è¡¨å½¢å¼ï¼Œæ—¢å¯ä»¥æ˜¯ <code>YAML list</code>
æ ¼å¼ï¼Œä¹Ÿå¯ä»¥æ˜¯ã€Œä¸€è¡Œä¸€é”®å€¼å¯¹ã€çš„ <code>å¤šè¡Œ</code> å­—ç¬¦ä¸²ã€‚</p>
</section>
<section class="slide level2">

<pre class="yaml"><code>ssh_pwauth: True</code></pre>
<p><code>ssh_pwauth</code> é…ç½® <code>/etc/ssh/sshd_config</code> é‡Œ
<code>PasswordAuthentication</code> å­—æ®µå€¼ã€‚</p>
</section></section>
<section>
<section id="æ­£å¼å…¥é—¨" class="title-slide slide level1">
<h1>æ­£å¼å…¥é—¨</h1>

</section>
<section id="å¿…è¯»å®˜æ–¹æ–‡æ¡£" class="slide level2">
<h2><a
href="https://cloudinit.readthedocs.io/en/latest/index.html">å¿…è¯»ï¼šå®˜æ–¹æ–‡æ¡£</a></h2>
<ul>
<li>å·¥ä¸šçº§æ ‡å‡†ï¼ˆ<a
href="https://cloudinit.readthedocs.io/en/latest/topics/availability.html">ä¸»æµ
Linux å‘è¡Œç‰ˆã€å…¬æœ‰äº‘æœåŠ¡æä¾›å•†ã€ç§æœ‰äº‘å¹³å°ã€è£¸æœºå®‰è£…</a>ï¼‰</li>
<li>æ”¯æŒä»å¤šç§ã€Œæ•°æ®æºã€åŠ è½½ç”¨æˆ·é…ç½®ï¼Œå®šåˆ¶ä»ã€ŒåŸºç¡€é•œåƒã€åˆ°ã€Œä¸ªæ€§åŒ–å¯ç”¨ç³»ç»Ÿã€çš„è‡ªåŠ¨åŒ–å®ç°</li>
</ul>
</section>
<section class="slide level2">

<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr>
<th>æ”¯æŒçš„å‘è¡Œç‰ˆ</th>
<th>æ”¯æŒçš„å…¬æœ‰äº‘</th>
<th>æ”¯æŒçš„ç§æœ‰äº‘</th>
</tr>
</thead>
<tbody>
<tr>
<td>Ubuntu<br />SLES/openSUSE<br />RHEL/CentOS<br />Fedora<br />Gentoo
Linux<br />Debian<br />ArchLinux<br />FreeBSD<br />NetBSD<br />OpenBSD<br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /></td>
<td>Amazon Web Services<br />Microsoft Azure<br />Google Cloud
Platform<br />Oracle Cloud Infrastructure<br />Softlayer<br />Rackspace
Public Cloud<br />IBM Cloud<br />Digital
Ocean<br />Bigstep<br />Hetzner<br />Joyent<br />CloudSigma<br />Alibaba
Cloud<br />OVH<br />OpenNebula<br />Exoscale<br />Scaleway<br />CloudStack<br />AltCloud<br />SmartOS<br />HyperOne<br />Rootbox<br /></td>
<td>Bare metal
installs<br />OpenStack<br />LXD<br />KVM<br />Metal-as-a-Service
(MAAS)<br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /></td>
</tr>
</tbody>
</table>
</section></section>
<section>
<section id="check-cloud-init-version" class="title-slide slide level1">
<h1>æŸ¥çœ‹å½“å‰å·²å®‰è£… Cloud-Init ç‰ˆæœ¬</h1>

</section>
<section class="slide level2">

<pre class="bash"><code>cloud-init --version
# /usr/bin/cloud-init 19.4-33-gbb4131a2-0ubuntu1~18.04.1</code></pre>
<p>æ ¹æ®ä»¥ä¸Šç‰ˆæœ¬ä¿¡æ¯ï¼Œæ¨èé˜…è¯»<a
href="https://cloudinit.readthedocs.io/en/19.4/index.html">å®˜æ–¹ v19.4
ç‰ˆæ–‡æ¡£</a> ã€‚</p>
</section></section>
<section>
<section id="æ•°æ®æº" class="title-slide slide level1">
<h1><a
href="https://cloudinit.readthedocs.io/en/19.4/topics/datasources.html">æ•°æ®æº</a></h1>

</section>
<section class="slide level2">

<ul>
<li>ã€Œæ•°æ®æºã€æŒ‡çš„æ˜¯ <code>cloud-init</code>
çš„é…ç½®æ•°æ®æ¥æºï¼Œé€šå¸¸æ¥è‡ªç”¨æˆ·ï¼ˆä¾‹å¦‚
<code>user-data</code>ï¼‰æˆ–æ¥è‡ªåˆ›å»ºé…ç½®é©±åŠ¨å™¨çš„äº‘ï¼ˆä¾‹å¦‚
<code>meta-data</code> ï¼‰ã€‚</li>
<li>å…¸å‹çš„ã€Œç”¨æˆ·æ•°æ®ã€åŒ…æ‹¬ã€Œæ–‡ä»¶ã€ï¼Œã€Œyamlã€å’Œã€ŒShell è„šæœ¬ã€</li>
<li>å…¸å‹çš„ã€Œå…ƒæ•°æ®ã€åŒ…æ‹¬ã€ŒæœåŠ¡å™¨åç§°ã€ï¼Œã€Œå®ä¾‹
IDã€ï¼Œã€Œæ˜¾ç¤ºåç§°ã€å’Œã€Œå…¶ä»–ç‰¹å®šäºäº‘æœåŠ¡æä¾›å•†ã€çš„è¯¦ç»†ä¿¡æ¯</li>
</ul>
</section>
<section class="slide level2">

<p>å®ä¾‹ï¼ˆInstanceï¼‰åœ¨äº‘è®¡ç®—åœºæ™¯ä¸­ï¼Œä¸€èˆ¬æŒ‡ã€Œäº‘ä¸»æœºå®ä¾‹ã€ã€‚å¯¹äº
<code>Virtualbox</code>
æ¥è¯´ï¼Œæ¯ä¸€ä¸ªæœ¬åœ°è™šæ‹Ÿæœºä¹Ÿå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªã€Œå®ä¾‹ã€ã€‚</p>
</section>
<section class="slide level2">

<p>å½“å‰ç³»ç»Ÿä¸Šæ‰§è¡Œè¿‡ <code>Cloud-Init</code> ä¹‹åä¼šå°†ã€Œå…ƒæ•°æ®ã€ä¿å­˜åœ¨
<code>/run/cloud-init/instance-data.json</code> ï¼Œå¦‚ä¸‹æ‰€ç¤ºæ˜¯ã€Œç¬¬ä¸€ä¸ª ğŸŒ°
ã€å¯¹åº”çš„ã€Œå…ƒæ•°æ®ã€ï¼š</p>
<pre class="json"><code>{
 &quot;base64_encoded_keys&quot;: [],
 &quot;ds&quot;: {
  &quot;_doc&quot;: &quot;EXPERIMENTAL: The structure and format of content scoped under the &#39;ds&#39; key may change in subsequent releases of cloud-init.&quot;,
  &quot;meta_data&quot;: {
   &quot;dsmode&quot;: &quot;net&quot;,
   &quot;instance-id&quot;: 1,
   &quot;local-hostname&quot;: &quot;cuc-cloud-init&quot;
  }
 },
 &quot;sensitive_keys&quot;: [],
 &quot;v1&quot;: {
  &quot;_beta_keys&quot;: [
   &quot;subplatform&quot;
  ],
  &quot;availability-zone&quot;: null,
  &quot;availability_zone&quot;: null,
  &quot;cloud-name&quot;: &quot;unknown&quot;,
  &quot;cloud_name&quot;: &quot;unknown&quot;,
  &quot;instance-id&quot;: &quot;1&quot;,
  &quot;instance_id&quot;: &quot;1&quot;,
  &quot;local-hostname&quot;: &quot;cuc-cloud-init&quot;,
  &quot;local_hostname&quot;: &quot;cuc-cloud-init&quot;,
  &quot;platform&quot;: &quot;nocloud&quot;,
  &quot;public_ssh_keys&quot;: [],
  &quot;region&quot;: null,
  &quot;subplatform&quot;: &quot;config-disk (/dev/sr0)&quot;
 }
}</code></pre>
</section>
<section class="slide level2">

<p><a
href="https://cloudinit.readthedocs.io/en/19.4/topics/datasources.html#known-sources">å·²çŸ¥æ”¯æŒæ•°æ®æºç±»å‹</a></p>
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th>æ’</th>
<th>å</th>
<th>ä¸</th>
<th>åˆ†</th>
<th>å…ˆå</th>
</tr>
</thead>
<tbody>
<tr>
<td>Alibaba Cloud (AliYun)</td>
<td>Alt Cloud</td>
<td>Azure</td>
<td>CloudSigma</td>
<td>CloudStack</td>
</tr>
<tr>
<td>Config Drive</td>
<td>Digital Ocean</td>
<td>E24Cloud</td>
<td>Amazon EC2</td>
<td>Exoscale</td>
</tr>
<tr>
<td>Fallback/None</td>
<td>Google Compute Engine</td>
<td>MAAS</td>
<td><strong>NoCloud</strong></td>
<td>OpenNebula</td>
</tr>
<tr>
<td>OpenStack</td>
<td>Oracle</td>
<td>OVF</td>
<td>Rbx Cloud</td>
<td>SmartOS Datasource</td>
</tr>
<tr>
<td>ZStack</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="æŸ¥çœ‹æˆ‘ä»¬åœ¨è™šæ‹Ÿæœºé‡Œä½¿ç”¨çš„æ•°æ®æºç±»å‹" class="slide level2">
<h2>æŸ¥çœ‹æˆ‘ä»¬åœ¨è™šæ‹Ÿæœºé‡Œä½¿ç”¨çš„æ•°æ®æºç±»å‹</h2>
<pre class="bash"><code>cloud-id
# nocloud</code></pre>
</section></section>
<section>
<section id="nocloud" class="title-slide slide level1">
<h1><a
href="https://cloudinit.readthedocs.io/en/19.4/topics/datasources/nocloud.html#nocloud">NoCloud</a></h1>

</section>
<section class="slide level2">

<p>å›é¡¾ä¹‹å‰æˆ‘ä»¬åˆ›å»º iso é•œåƒæ–‡ä»¶æ—¶ä½¿ç”¨çš„å‘½ä»¤</p>
<pre class="bash"><code>genisoimage -output init-cidata.iso -volid cidata -joliet -rock user-data meta-data</code></pre>
<ul>
<li><code>-volid cidata</code> æŒ‡å®šæ–°åˆ›å»ºçš„ iso æ–‡ä»¶çš„ã€Œå·æ ‡è¯†ã€ä¸º
<code>cidata</code></li>
</ul>
<p><img data-src="images/cloud-init/nocloud-cidata.png" /></p>
</section>
<section class="slide level2">

<p>å›é¡¾ä¹‹å‰æˆ‘ä»¬åˆ›å»º iso é•œåƒæ–‡ä»¶æ—¶ä½¿ç”¨çš„å‘½ä»¤</p>
<pre class="bash"><code>genisoimage -output init-cidata.iso -volid cidata -joliet -rock user-data meta-data</code></pre>
<p><img data-src="images/cloud-init/nocloud-contents.png" /></p>
<ul>
<li>iso é•œåƒæ–‡ä»¶é‡Œçš„æ–‡ä»¶åå¿…é¡»æ˜¯ <code>user-data</code> å’Œ
<code>meta-data</code></li>
</ul>
</section>
<section class="slide level2">

<p>å›é¡¾ä¹‹å‰çš„ <code>meta-data</code> æ–‡ä»¶å†…å®¹</p>
<pre class="yaml"><code>instance-id: 1
local-hostname: cuc-cloud-init</code></pre>
<p>å…¶ä¸­ <code>instance-id: 1</code> ç”¨æ¥å‘Šè¯‰ <code>cloud-init</code>
å¼•æ“è¯¥å®ä¾‹ã€Œæ˜¯å¦é¦–æ¬¡å¯åŠ¨ã€ã€‚</p>
<pre class="bash"><code># æŸ¥çœ‹è¯¥å®ä¾‹å¯åŠ¨è¿‡ä¸€æ¬¡ä¹‹ååœ¨å½“å‰ç³»ç»Ÿå†…ç•™ä¸‹çš„ç—•è¿¹
ls /var/lib/cloud/instances/1/
# boot-finished     datasource  obj.pkl  sem            user-data.txt.i  vendor-data.txt.i
# cloud-config.txt  handlers    scripts  user-data.txt  vendor-data.txt</code></pre>
</section>
<section class="slide level2">

<p>å…¶ä¸­ <code>boot-finished</code>
æ–‡ä»¶è®°å½•äº†è¯¥å®ä¾‹å®šä¹‰çš„å¯åŠ¨æ—¶é—´ï¼Œä¾‹å¦‚ï¼š</p>
<pre class="bash"><code>cat /var/lib/cloud/instances/1/boot-finished
# 11.28 - Tue, 14 Apr 2020 07:33:47 +0000 - v. 19.4-33-gbb4131a2-0ubuntu1~18.04.1</code></pre>
</section>
<section class="slide level2">

<p>å½“ä¸Šè¿°ç›®å½•ç»“æ„å­˜åœ¨æ—¶ï¼Œåªè¦ <code>init-cidata.iso</code>
å†…å®¹ä¸å˜ã€‚å³ä½¿ä¸€ç›´æŒ‚è½½åœ¨è™šæ‹Ÿæœºçš„å…‰é©±é‡Œï¼Œæ¯æ¬¡å¯åŠ¨è™šæ‹Ÿæœºç³»ç»Ÿæ—¶ï¼Œä¹Ÿä¸ä¼šå†é‡æ–°æ‰§è¡Œä¸€éå…‰ç›˜é‡Œå®šä¹‰çš„
<code>cloud-init</code> æ“ä½œäº†ã€‚</p>
</section>
<section class="slide level2">

<p>å¦‚æœå¸Œæœ›é‡æ–°æ‰§è¡Œ <code>init-cidata.iso</code> é‡Œå®šä¹‰çš„æ“ä½œï¼Œéœ€è¦å˜æ›´
<code>meta-data</code> æ–‡ä»¶é‡Œçš„ <code>instance-id</code> èµ‹å€¼ä¸º
<code>/var/lib/cloud/instances/</code> ä¸‹ä¸å­˜åœ¨é‡åå­ç›®å½•çš„å…¶ä»–å€¼ã€‚</p>
</section></section>
<section>
<section id="debug-user-data" class="title-slide slide level1">
<h1><a
href="https://cloudinit.readthedocs.io/en/19.4/topics/faq.html#how-can-i-debug-my-user-data">è°ƒè¯•
user-data</a></h1>

</section>
<section class="slide level2">

<pre class="bash"><code># éªŒè¯ user-data æ–‡ä»¶æ˜¯å¦å­˜åœ¨è¯­æ³•é”™è¯¯
cloud-init devel schema -c user-data --annotate
# Valid cloud-config file user-data</code></pre>
</section></section>
<section>
<section id="è®¤è¯†æ¨¡å—" class="title-slide slide level1">
<h1>è®¤è¯†æ¨¡å—</h1>

</section>
<section class="slide level2">

<ul>
<li><a
href="https://cloudinit.readthedocs.io/en/19.4/topics/cli.html#modules">/etc/cloud/cloud.cfg</a>
ä¸­å®šä¹‰äº†å½“å‰ç³»ç»Ÿä¸­ <code>Cloud-Init</code>
åœ¨ã€Œä¸åŒé˜¶æ®µã€åŠ è½½äº†å“ªäº›æ¨¡å—ã€‚</li>
</ul>
</section>
<section id="boot-stages" class="slide level2">
<h2><a
href="https://cloudinit.readthedocs.io/en/19.4/topics/boot.html">Cloud-Init
ä¸»è¦é˜¶æ®µ</a></h2>
<p>ç»“åˆ <code>/etc/cloud/cloud.cfg</code>
æ–‡ä»¶å†…å®¹æ¥ç†è§£ä¸åŒã€Œå¯åŠ¨é˜¶æ®µã€ï¼šæ–‡ä»¶ä¸­ä¸€å…±å®šä¹‰äº† 3 ä¸ªé˜¶æ®µ:</p>
<ul>
<li>init</li>
<li>config</li>
<li>final</li>
</ul>
<p>æ¯ä¸ªé˜¶æ®µå¯ä»¥ã€Œå®Œæˆã€å“ªäº›æ“ä½œå¯ä»¥æ ¹æ®åŒ…å«çš„ã€Œæ¨¡å—ã€åŠŸèƒ½çŸ¥æ‚‰ã€‚</p>
</section>
<section class="slide level2">

<p><code>/etc/cloud/cloud.cfg</code> ğŸŒ°</p>
<pre class="yaml"><code># ref: https://cloudinit.readthedocs.io/en/19.4/topics/modules.html
# ä»¥ä¸‹å„ä¸ªé˜¶æ®µå®šä¹‰çš„ã€Œæ¨¡å—ã€å‡åœ¨ä»¥ä¸Šå®˜æ–¹æ–‡æ¡£ä¸­æœ‰è¯¦ç»†ä½¿ç”¨è¯´æ˜

# The modules that run in the &#39;init&#39; stage
cloud_init_modules:
 - migrator
 - seed_random
 - bootcmd
 - write-files
 - growpart
 - resizefs
 - disk_setup
 - mounts
 - set_hostname
 - update_hostname
 - update_etc_hosts
 - ca-certs
 - rsyslog
 - users-groups
 - ssh

# The modules that run in the &#39;config&#39; stage
cloud_config_modules:
# Emit the cloud config ready event
# this can be used by upstart jobs for &#39;start on cloud-config&#39;.
 - emit_upstart
 - snap
 - ssh-import-id
 - locale
 - set-passwords
 - grub-dpkg
 - apt-pipelining
 - apt-configure
 - ubuntu-advantage
 - ntp
 - timezone
 - disable-ec2-metadata
 - runcmd
 - byobu

# The modules that run in the &#39;final&#39; stage
cloud_final_modules:
 - package-update-upgrade-install
 - fan
 - landscape
 - lxd
 - ubuntu-drivers
 - puppet
 - chef
 - mcollective
 - salt-minion
 - rightscale_userdata
 - scripts-vendor
 - scripts-per-once
 - scripts-per-boot
 - scripts-per-instance
 - scripts-user
 - ssh-authkey-fingerprints
 - keys-to-console
 - phone-home
 - final-message
 - power-state-change</code></pre>
</section>
<section class="slide level2">

<p>ç»“åˆ <a
href="https://cloudinit.readthedocs.io/en/19.4/topics/boot.html">å®˜æ–¹æ–‡æ¡£é‡Œã€Œå¯åŠ¨é˜¶æ®µã€</a>
ä¸€èŠ‚çš„æè¿°å¯çŸ¥ï¼š<code>init</code> é˜¶æ®µåˆå¯ä»¥åˆ†ä¸ºï¼š</p>
<ul>
<li>Generator</li>
<li>Local</li>
<li>Network</li>
</ul>
</section></section>
<section>
<section id="ç†è§£æ¨¡å—" class="title-slide slide level1">
<h1>ç†è§£æ¨¡å—</h1>

</section>
<section class="slide level2">

<p>ç›¸å½“äºã€Œå¯¼å…¥å‡½æ•°ã€æˆ–ã€Œå¯¼å…¥åº“ã€çš„ä½œç”¨ï¼Œå¦‚æœåœ¨æŒ‡å®šã€Œå¯åŠ¨é˜¶æ®µã€æ²¡æœ‰ã€Œå®šä¹‰ã€ä½¿ç”¨æŸä¸ªã€Œæ¨¡å—ã€ï¼Œåˆ™åœ¨
<code>user-data</code> ä¸­ä¸èƒ½è°ƒç”¨ç›¸åº”æŒ‡ä»¤ã€‚</p>
</section>
<section class="slide level2">

<p>å†å›çœ‹ã€Œç¬¬ä¸€ä¸ª ğŸŒ° ã€</p>
<pre class="yaml"><code>#cloud-config
password: mypassword 
chpasswd: { expire: False }
ssh_pwauth: True</code></pre>
<p>ä¸Šè¿° 3 ä¸ªé…ç½®æŒ‡ä»¤ <code>password</code>, <code>chpasswd</code>,
<code>ssh_pwauth</code> å‡å®šä¹‰åœ¨ <a
href="https://cloudinit.readthedocs.io/en/latest/topics/modules.html#set-passwords">set-passwords</a>
æ¨¡å—ä¸­ã€‚</p>
</section></section>
<section>
<section id="ç†è§£ç¼ºçœè®¾ç½®" class="title-slide slide level1">
<h1>ç†è§£ç¼ºçœè®¾ç½®</h1>

</section>
<section class="slide level2">

<pre class="yaml"><code># The top level settings are used as module
# and system configuration.

# A set of users which may be applied and/or used by various modules
# when a &#39;default&#39; entry is found it will reference the &#39;default_user&#39;
# from the distro configuration specified below
users:
   - default

# If this is set, &#39;root&#39; will not be able to ssh in and they
# will get a message to login instead as the default $user
disable_root: true

# This will cause the set+update hostname module to not operate (if true)
preserve_hostname: false

# Example datasource config
# datasource:
#    Ec2:
#      metadata_urls: [ &#39;blah.com&#39; ]
#      timeout: 5 # (defaults to 50 seconds)
#      max_wait: 10 # (defaults to 120 seconds)

# æ­¤å¤„çœç•¥ 3 ä¸ªé˜¶æ®µçš„æ¨¡å—å®šä¹‰ç›¸å…³æŒ‡ä»¤

# System and/or distro specific settings
# (not accessible to handlers/transforms)
system_info:
   # This will affect which distro class gets used
   distro: ubuntu
   # Default user name + that default users groups (if added/used)
   default_user:
     name: ubuntu
     lock_passwd: True
     gecos: Ubuntu
     groups: [adm, audio, cdrom, dialout, dip, floppy, lxd, netdev, plugdev, sudo, video]
     sudo: [&quot;ALL=(ALL) NOPASSWD:ALL&quot;]
     shell: /bin/bash
   # Automatically discover the best ntp_client
   ntp_client: auto
   # Other config here will be given to the distro class and/or path classes
   paths:
      cloud_dir: /var/lib/cloud/
      templates_dir: /etc/cloud/templates/
      upstart_dir: /etc/init/
   package_mirrors:
     - arches: [i386, amd64]
       failsafe:
         primary: http://archive.ubuntu.com/ubuntu
         security: http://security.ubuntu.com/ubuntu
       search:
         primary:
           - http://%(ec2_region)s.ec2.archive.ubuntu.com/ubuntu/
           - http://%(availability_zone)s.clouds.archive.ubuntu.com/ubuntu/
           - http://%(region)s.clouds.archive.ubuntu.com/ubuntu/
         security: []
     - arches: [arm64, armel, armhf]
       failsafe:
         primary: http://ports.ubuntu.com/ubuntu-ports
         security: http://ports.ubuntu.com/ubuntu-ports
       search:
         primary:
           - http://%(ec2_region)s.ec2.ports.ubuntu.com/ubuntu-ports/
           - http://%(availability_zone)s.clouds.ports.ubuntu.com/ubuntu-ports/
           - http://%(region)s.clouds.ports.ubuntu.com/ubuntu-ports/
         security: []
     - arches: [default]
       failsafe:
         primary: http://ports.ubuntu.com/ubuntu-ports
         security: http://ports.ubuntu.com/ubuntu-ports
   ssh_svcname: ssh</code></pre>
</section></section>
<section>
<section id="cloud-init-real-example" class="title-slide slide level1">
<h1>cloud-init å®æˆ˜ ğŸŒ°</h1>

</section>
<section id="éœ€æ±‚æè¿°" class="slide level2">
<h2>éœ€æ±‚æè¿°</h2>
<ol type="1">
<li>é‡ç½® <a
href="https://www.freedesktop.org/software/systemd/man/machine-id.html">machine-id</a></li>
<li>æ·»åŠ  ssh å…å¯†ç™»å½•</li>
<li>å®‰è£… python3</li>
</ol>
</section></section>
<section>
<section id="why-reset-machine-id" class="title-slide slide level1">
<h1>ä¸ºä»€ä¹ˆéœ€è¦é‡ç½® <code>machine-id</code></h1>

</section>
<section id="machine-id-1" class="slide level2">
<h2>machine-id</h2>
<blockquote>
<p>The <code>/etc/machine-id</code> file contains the unique machine ID
of the local system that is set during installation or boot. The machine
ID is a single newline-terminated, hexadecimal, 32-character, lowercase
ID. When decoded from hexadecimal, this corresponds to a 16-byte/128-bit
value. This ID may not be all zeros.</p>
</blockquote>
</section>
<section id="machine-id-2" class="slide level2">
<h2>machine-id</h2>
<blockquote>
<p>systemd-machine-id-setup(1) may be used by installer tools to
initialize the machine ID at install time, but /etc/machine-id may also
be written using any other means.</p>
</blockquote>
</section>
<section id="machine-id-3" class="slide level2">
<h2>machine-id</h2>
<blockquote>
<p>For operating system images which are created once and used on
multiple machines, for example for containers or in the cloud,
<code>/etc/machine-id</code> <strong>should be an empty file</strong> in
the generic file system image.
<code>An ID will be generated during boot and saved to this file if possible</code>.
<strong>Having an empty file</strong> in place is useful because it
allows a temporary file to be bind-mounted over the real file, in case
the image is used read-only.</p>
</blockquote>
</section>
<section id="machine-id-4" class="slide level2">
<h2>machine-id</h2>
<blockquote>
<p>å¯¹äº Debian åŠå…¶è¡ç”Ÿå‘è¡Œç‰ˆï¼Œä¾‹å¦‚ Kali
ï¼Œä»¥ä¸Šæ“ä½œæ­¥éª¤å‡å¯èƒ½å¤±æ•ˆï¼šæ— æ³•æ›´æ–° /etc/machine-id ã€‚</p>
</blockquote>
<pre class="bash"><code># Virtualbox çš„å¤šé‡åŠ è½½é•œåƒæœºåˆ¶å…‹éš†å‡ºæ¥çš„è™šæ‹Ÿæœºä½¿ç”¨çš„è™šæ‹Ÿç£ç›˜ï¼Œç£ç›˜ uuid å€¼æ˜¯ç›¸åŒçš„
sudo blkid /dev/sda1
# /dev/sda1: UUID=&quot;dff30eeb-7332-438d-964c-d5c7f4d357f7&quot; BLOCK_SIZE=&quot;4096&quot; TYPE=&quot;ext4&quot; PARTUUID=&quot;f0f6b9b0-01&quot;

ls -l /dev/disk/by-uuid
# lrwxrwxrwx 1 root root 10 Dec  3 00:32 dff30eeb-7332-438d-964c-d5c7f4d357f7 -&gt; ../../sda1

# /etc/machine-id çš„å€¼ä¸ç£ç›˜ uuid å€¼æ— å…³
# å±€åŸŸç½‘ä¸­ï¼Œã€ä¸åŒä¸»æœºã€‘çš„ç£ç›˜åˆ†åŒº uuid å€¼ç›¸åŒæ— å½±å“ï¼Œä½†è¦é¿å… machine-id å€¼é‡å¤
# machine-id é‡å¤çš„ä¸€ä¸ªæœ€ç›´æ¥å½±å“æ˜¯å¯¹äºä½¿ç”¨ Net-Plan æ–¹å¼è¿›è¡Œ DHCP è·å– IP åœ°å€çš„å®¢æˆ·ç«¯æ¥è¯´ï¼Œç¼ºçœ DHCP è¯·æ±‚ç­–ç•¥ä¼šå¯¼è‡´å±€åŸŸç½‘ä¸­å‡ºç° IP åœ°å€å†²çª
# é™¤æ­¤ä¹‹å¤–ï¼Œå¯¹äºåˆ†å¸ƒå¼é›†ç¾¤ç³»ç»Ÿæ¥è¯´ï¼Œé‡å¤ machine-id å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›ä¸ç¡®å®šæ€§é”™è¯¯

# ref-1: https://unix.stackexchange.com/questions/402999/is-it-ok-to-change-etc-machine-id
# ref-2: https://documentation.suse.com/external-tree/en-us/suma/4.0/suse-manager/administration/tshoot-registerclones.html
# TL;DR å¯¹äº Debian åŠå…¶è¡ç”Ÿå‘è¡Œç‰ˆç³»ç»Ÿ /etc/machine-id çš„å€¼æ˜¯åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶æ‹·è´è‡ª /var/lib/dbus/machine-id
sudo rm /var/lib/dbus/machine-id /etc/machine-id

## ref-1 çš„æ–¹æ³•
sudo dbus-uuidgen --ensure=/etc/machine-id
# ä» /etc/machine-id æ‹·è´å†…å®¹åˆ° /var/lib/dbus/machine-id
sudo dbus-uuidgen --ensure

## ref-2 çš„æ–¹æ³•
# å½“ /etc/machine-id å†…å®¹ä¸ºç©ºæˆ–æ–‡ä»¶ç¼ºå¤±æ—¶ï¼Œåˆ›å»º /var/lib/dbus/machine-id å¹¶å†™å…¥ machine-id
sudo dbus-uuidgen --ensure
# ä» /var/lib/dbus/machine-id æ‹·è´å†…å®¹åˆ° /etc/machine-id
sudo systemd-machine-id-setup

# ä»¥ä¸Š ref-1 å’Œ ref-2 çš„æ–¹æ³•åœ¨ Kali ä¸Šæ•ˆæœç›¸åŒ
# éªŒè¯ machine-id
cat /etc/machine-id
cat /var/lib/dbus/machine-id

# é‡å¯ç³»ç»Ÿï¼Œä»¥ç¡®ä¿é…ç½®å˜æ›´ç”Ÿæ•ˆ
sudo reboot</code></pre>
</section>
<section id="ä¸ºä»€ä¹ˆæˆ‘å…‹éš†å‡ºæ¥çš„è™šæ‹Ÿæœºæ€»æ˜¯è·å¾—ç›¸åŒ-ip-åœ°å€"
class="slide level2">
<h2>ä¸ºä»€ä¹ˆæˆ‘å…‹éš†å‡ºæ¥çš„è™šæ‹Ÿæœºæ€»æ˜¯è·å¾—ç›¸åŒ IP åœ°å€ï¼Ÿ</h2>
<p>æ ¹æ®<a href="https://unix.stackexchange.com/a/419322">ç½‘å‹
<code>wickedchicken</code> åœ¨ SO ç½‘ç«™ä¸Šçš„å›ç­”</a></p>
<blockquote>
<p><code>systemd-networkd</code> uses a different method to generate the
DUID than <code>dhclient</code>. <code>dhclient</code> <a
href="https://manpages.debian.org/jessie/isc-dhcp-client/dhclient.8.en.html">by
default uses the link-layer address</a> while systemd-networkd uses <a
href="https://www.freedesktop.org/software/systemd/man/networkd.conf.html#DUIDType=">the
contents of /etc/machine-id</a>. Since the VMs were cloned, they have
the same <code>machine-id</code> and the DHCP server returns the same IP
for both.</p>
</blockquote>
</section>
<section class="slide level2">

<blockquote>
<p>To fix, replace the contents of one or both of /etc/machine-id. This
can be anything, but deleting the file and running
systemd-machine-id-setup will create a random machine-id in the same way
done on machine setup.</p>
</blockquote>
</section>
<section class="slide level2">

<p>å¦ä¸€ç§è§£å†³æ–¹æ¡ˆï¼šä¿®æ”¹ <code>/etc/netplan/01-netcfg.yaml</code>
ï¼Œåœ¨ç½‘å¡çš„ <code>dhcp</code> é…ç½®åˆ—è¡¨é‡Œæ·»åŠ é…ç½®å‚æ•°ï¼š<a
href="https://netplan.io/reference">dhcp-identifier: mac</a></p>
<pre class="yaml"><code># ref: https://netplan.io/examples#integration-with-a-windows-dhcp-server
network:
  version: 2
  ethernets:
    enp0s3:
      dhcp4: yes
    enp8s0:
      dhcp4: yes
      dhcp-identifier: mac</code></pre>
</section>
<section id="reboot-after-machine-id-reset" class="slide level2">
<h2>å˜æ›´ <code>machine-id</code> ä¹‹åä¸ºä»€ä¹ˆéœ€è¦é‡å¯</h2>
<p>ä»¥ä¸‹å†…å®¹æ‘˜è‡ª <code>man dbus-uuidgen</code></p>
<blockquote>
<p>If you try to change an existing machine-id on a running system, it
will probably result in bad things happening. Donâ€™t try to change this
file. Also, donâ€™t make it the same on two different systems; it needs to
be different anytime there are two different kernels running.</p>
</blockquote>
</section>
<section class="slide level2">

<p>ä»¥ä¸‹ç»“è®ºæ‘˜è‡ª <a href="https://unix.stackexchange.com/a/403054">ç½‘å‹
<code>hvd</code> åœ¨ SO ç½‘ç«™ä¸Šçš„å›ç­”ç»“è®º</a> ï¼š</p>
<blockquote>
<p><strong>So after doing this, definitely donâ€™t continue using the
system without rebooting.</strong></p>
</blockquote>
</section></section>
<section>
<section id="cloud-init-real-example-get-started"
class="title-slide slide level1">
<h1>cloud-init å®æˆ˜ ğŸŒ° é©¬ä¸Šå¼€å§‹</h1>

</section>
<section class="slide level2">

<ol type="1">
<li>ç¡®ä¿ç›®æ ‡ç³»ç»Ÿå†…å·²å®‰è£… <code>cloud-init</code></li>
<li>æ£€æŸ¥ <code>/etc/machine-id</code> æ­¤æ—¶çš„å€¼</li>
<li>æ£€æŸ¥ <code>/etc/netplan/</code> ç›®å½•ä¸‹æ­¤æ—¶çš„æ–‡ä»¶</li>
<li>æ£€æŸ¥ <code>/etc/netplan/01-netcfg.yaml</code> æ–‡ä»¶å†…å®¹</li>
<li>æ£€æŸ¥å½“å‰ç¬¬äºŒå—ç½‘å¡çš„ IP åœ°å€</li>
</ol>
</section>
<section id="å…³é”®é…ç½®" class="slide level2">
<h2>å…³é”®é…ç½®</h2>
<ul>
<li><code>user-data</code></li>
<li><code>meta-data</code></li>
</ul>
</section>
<section class="slide level2">

<h3 id="user-data-real-example"><code>user-data</code> ç¤ºä¾‹</h3>
<pre class="yaml"><code>#cloud-config
users:
  - name: cuc
    lock_passwd: false # Disable password login. Default: true
    passwd: 123456 # !!DEMO only!! Hashed password is recommended in Production.
    ssh_authorized_keys:
      - &lt;ssh-pub-key-1&gt;
      - &lt;ssh-pub-key-2&gt;

# run the following cmds after system is booted and rootfs is mounted
runcmd:
  - echo -n &#39;&#39; &gt; /etc/machine-id # clear but not delete
  - /bin/systemd-machine-id-setup

# Install additional packages on first boot
#
# Default: none
#
# if packages are specified, this apt_update will be set to true
#
# packages may be supplied as a single package name or as a list
# with the format [&lt;package&gt;, &lt;version&gt;] wherein the specifc
# package version will be installed.
packages:
  - python3 # required by ansible remote 

## poweroff or reboot system after finished
# default: none
#
# power_state can be used to make the system shutdown, reboot or
# halt after boot is finished.  This same thing can be acheived by
# user-data scripts or by runcmd by simply invoking &#39;shutdown&#39;.
#
# Doing it this way ensures that cloud-init is entirely finished with
# modules that would be executed, and avoids any error/log messages
# that may go to the console as a result of system services like
# syslog being taken down while cloud-init is running.
#
# If you delay &#39;+5&#39; (5 minutes) and have a timeout of
# 120 (2 minutes), then the max time until shutdown will be 7 minutes.
# cloud-init will invoke &#39;shutdown +5&#39; after the process finishes, or
# when &#39;timeout&#39; seconds have elapsed.
#
# delay: form accepted by shutdown.  default is &#39;now&#39;. other format
#        accepted is +m (m in minutes)
# mode: required. must be one of &#39;poweroff&#39;, &#39;halt&#39;, &#39;reboot&#39;
# message: provided as the message argument to &#39;shutdown&#39;. default is none.
# timeout: the amount of time to give the cloud-init process to finish
#          before executing shutdown.
# condition: apply state change only if condition is met.
#            May be boolean True (always met), or False (never met),
#            or a command string or list to be executed.
#            command&#39;s exit code indicates:
#               0: condition met
#               1: condition not met
#            other exit codes will result in &#39;not met&#39;, but are reserved
#            for future use.
#
power_state:
 delay: &quot;now&quot;
 mode: reboot
 message: Make new machine-id take effect
 timeout: 10
 condition: True</code></pre>
</section>
<section class="slide level2">

<h3 id="meta-data-real-example"><code>meta-data</code> ç¤ºä¾‹</h3>
<pre class="yaml"><code>instance-id: 1
local-hostname: ansible-slave</code></pre>
</section>
<section id="å®éªŒå®Œæˆåæ£€æŸ¥æ¸…å•" class="slide level2">
<h2>å®éªŒå®Œæˆåæ£€æŸ¥æ¸…å•</h2>
<ol type="1">
<li>æ£€æŸ¥ <code>/etc/machine-id</code> æ­¤æ—¶çš„å€¼</li>
<li>æ£€æŸ¥ <code>/etc/netplan/</code> ç›®å½•ä¸‹æ­¤æ—¶çš„æ–‡ä»¶</li>
<li>æ£€æŸ¥å½“å‰ç¬¬äºŒå—ç½‘å¡çš„ IP åœ°å€</li>
</ol>
</section></section>
<section>
<section id="more-examples" class="title-slide slide level1">
<h1>æ›´å¤æ‚çš„ ğŸŒ° ä»¬</h1>

</section>
<section class="slide level2">

<p><a
href="https://cloudinit.readthedocs.io/en/19.4/topics/examples.html">å®˜æ–¹æ–‡æ¡£ä¸­ç»™å‡ºçš„æ›´å¤š
cloud-config é…ç½®æ–‡ä»¶ç¤ºä¾‹</a></p>
</section></section>
    </div>
  </div>

  <script src="reveal.js/lib/js/head.min.js"></script>
  <script src="reveal.js/js/reveal.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        // Display controls in the bottom right corner
        controls: true,
        // Display a presentation progress bar
        progress: true,
        // Display the page number of the current slide
        slideNumber: true,
        // Push each slide change to the browser history
        history: true,
        // Enable keyboard shortcuts for navigation
        keyboard: true,
        // Enable the slide overview mode
        overview: true,
        // Vertical centering of slides
        center: true,
        // Enables touch navigation on devices with touch input
        touch: true,
        // see https://github.com/hakimel/reveal.js/#navigation-mode
        navigationMode: 'default',
        // Turns fragments on and off globally
        fragments: true,
        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,
        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,
        // Stop auto-sliding after user input
        autoSlideStoppable: true,
        // Transition style
        transition: 'fade', // none/fade/slide/convex/concave/zoom
        // Transition speed
        transitionSpeed: 'default', // default/fast/slow
        // Transition style for full page slide backgrounds
        backgroundTransition: 'fade', // none/fade/slide/convex/concave/zoom
        // Number of slides away from the current that are visible
        viewDistance: 3,
        math: {
          mathjax: '',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

menu: {
		// Specifies which side of the presentation the menu will 
		// be shown. Use 'left' or 'right'.
		side: 'left',

		// Specifies the width of the menu.
		// Can be one of the following:
		// 'normal', 'wide', 'third', 'half', 'full', or
		// any valid css length value
		width: 'normal',

		// Add slide numbers to the titles in the slide list.
		// Use 'true' or format string (same as reveal.js slide numbers)
		numbers: false,

		// Specifies which slide elements will be used for generating
		// the slide titles in the menu. The default selects the first
		// heading element found in the slide, but you can specify any
		// valid css selector and the text from the first matching
		// element will be used.
		// Note: that a section data-menu-title attribute or an element
		// with a menu-title class will take precedence over this option
		titleSelector: 'h1, h2, h3, h4, h5, h6',

		// If slides do not have a matching title, attempt to use the
		// start of the text content as the title instead
		useTextContentForMissingTitles: false,

		// Hide slides from the menu that do not have a title.
		// Set to 'true' to only list slides with titles.
		hideMissingTitles: false,

		// Adds markers to the slide titles to indicate the 
		// progress through the presentation. Set to 'false'
		// to hide the markers.
		markers: true,

		// Specify custom panels to be included in the menu, by
		// providing an array of objects with 'title', 'icon'
		// properties, and either a 'src' or 'content' property.
		custom: false,

		// Specifies the themes that will be available in the themes
		// menu panel. Set to 'true' to show the themes menu panel
		// with the default themes list. Alternatively, provide an
		// array to specify the themes to make available in the
		// themes menu panel, for example...
		// [
		//     { name: 'Black', theme: 'css/theme/black.css' },
		//     { name: 'White', theme: 'css/theme/white.css' },
		//     { name: 'League', theme: 'css/theme/league.css' }
		// ]
		themes: false,

		// Specifies the path to the default theme files. If your
		// presentation uses a different path to the standard reveal
		// layout then you need to provide this option, but only
		// when 'themes' is set to 'true'. If you provide your own 
		// list of themes or 'themes' is set to 'false' the 
		// 'themesPath' option is ignored.
		themesPath: 'css/theme/',

		// Specifies if the transitions menu panel will be shown.
		// Set to 'true' to show the transitions menu panel with
		// the default transitions list. Alternatively, provide an
		// array to specify the transitions to make available in
		// the transitions panel, for example...
		// ['None', 'Fade', 'Slide']
		transitions: false,

		// Adds a menu button to the slides to open the menu panel.
		// Set to 'false' to hide the button.
		openButton: true,

		// If 'true' allows the slide number in the presentation to
		// open the menu panel. The reveal.js slideNumber option must 
		// be displayed for this to take effect
		openSlideNumber: false,

		// If true allows the user to open and navigate the menu using
		// the keyboard. Standard keyboard interaction with reveal
		// will be disabled while the menu is open.
		keyboard: true,

		// Normally the menu will close on user actions such as
		// selecting a menu item, or clicking the presentation area.
		// If 'true', the sticky option will leave the menu open
		// until it is explicitly closed, that is, using the close
		// button or pressing the ESC or m key (when the keyboard 
		// interaction option is enabled).
		sticky: false,

		// If 'true' standard menu items will be automatically opened
		// when navigating using the keyboard. Note: this only takes 
		// effect when both the 'keyboard' and 'sticky' options are enabled.
		autoOpen: true,

		// If 'true' the menu will not be created until it is explicitly
		// requested by calling RevealMenu.init(). Note this will delay
		// the creation of all menu panels, including custom panels, and
		// the menu button.
		delayInit: false,

		// If 'true' the menu will be shown when the menu is initialised.
		openOnInit: false,

		// By default the menu will load it's own font-awesome library
		// icons. If your presentation needs to load a different
		// font-awesome library the 'loadIcons' option can be set to false
		// and the menu will not attempt to load the font-awesome library.
		loadIcons: true
	},


        // Optional reveal.js plugins
        dependencies: [
          { src: 'reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'reveal.js/plugin/zoom-js/zoom.js', async: true },
          { src: 'reveal.js/plugin/math/math.js', async: true },
          { src: 'reveal.js/plugin/menu/menu.js'},
          { src: 'reveal.js/plugin/markdown/marked.js'},
          { src: 'reveal.js/plugin/markdown/markdown.js'},
          { src: 'reveal.js/plugin/search/search.js'},
          { src: 'reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: 'reveal.js/plugin/notes/notes.js', async: true }
        ]
      });
    </script>
    </body>
</html>
